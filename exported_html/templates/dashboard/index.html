{% extends 'base.html' %}
{% block title %}Dashboard - SkillentHub{% endblock %}

{% block content %}
<div class="container-fluid px-md-4">
    <div class="row g-4">
        <!-- LEFT COLUMN: Profile & Navigation -->
        <div class="col-lg-3 d-none d-lg-block">
            <!-- Profile Card -->
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden mb-4 sticky-top"
                style="top: 90px; z-index: 10;">
                <div class="card-body text-center p-0">
                    <!-- Banner Background -->
                    <div class="bg-primary bg-gradient h-100px position-relative" style="height: 100px;"></div>

                    <!-- Avatar -->
                    <div class="position-relative mt-n5 px-4">
                        {% if user and user.profile_pic %}
                        <img src="{{ url_for('static', filename='uploads/profiles/' ~ user.profile_pic) }}"
                            class="rounded-circle border border-4 border-white shadow-sm bg-white"
                            style="width: 80px; height: 80px; object-fit: cover;" alt="{{ user.full_name }}">
                        {% else %}
                        <div class="rounded-circle border border-4 border-white shadow-sm bg-light d-inline-flex align-items-center justify-content-center mt-0"
                            style="width: 80px; height: 80px;">
                            <i class="fas fa-user col-grey fs-3"></i>
                        </div>
                        {% endif %}
                    </div>

                    <div class="p-3 pt-2">
                        <h5 class="fw-bold fs-6 mb-1">{{ session.get('user_name', 'User') }}</h5>
                        <p class="text-muted small mb-3">{{ user.headline if user.headline else 'SkillentHub Member' }}
                        </p>

                        <div class="d-flex justify-content-between border-top pt-3 text-start">
                            <div class="px-2 w-100">
                                <span class="d-block small text-muted fw-bold">Profile Views</span>
                                <span class="text-primary fw-bold">142</span>
                            </div>
                            <div class="border-start px-2 w-100">
                                <span class="d-block small text-muted fw-bold">Connections</span>
                                <span class="text-primary fw-bold">{{ total_connections }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-light p-3 border-top text-start">
                        <a href="{{ url_for('profile.view_profile', user_id=session.get('user_id')) }}"
                            class="small fw-bold text-dark text-decoration-none">
                            <i class="fas fa-bookmark me-2 text-primary"></i> My Items
                        </a>
                    </div>
                </div>
            </div>

            <!-- Quick Links / Groups (Static for now) -->
            <div class="card border-0 shadow-sm rounded-4 mb-4 sticky-top" style="top: 360px;">
                <div class="card-body p-3">
                    <h6 class="text-muted small fw-bold mb-3">RECENT</h6>
                    <ul class="list-unstyled small mb-0 spacing-y-2">
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none"><i
                                    class="fas fa-hashtag me-2"></i>webdevelopment</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none"><i
                                    class="fas fa-hashtag me-2"></i>interviews</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none"><i
                                    class="fas fa-hashtag me-2"></i>career</a></li>
                        <li class="mb-2"><a href="#" class="text-muted text-decoration-none"><i
                                    class="fas fa-users me-2"></i>Python Developers</a></li>
                    </ul>
                    <hr class="my-3">
                    <a href="#" class="text-primary fw-bold small text-decoration-none">Discover More</a>
                </div>
            </div>
        </div>

        <!-- CENTER COLUMN: Stats & Activity Feed -->
        <div class="col-lg-6 col-md-12">
            <!-- Stats Row -->
            <div class="row g-3 mb-4">
                <div class="col-4">
                    <div class="card border-0 shadow-sm rounded-4 text-center h-100 hover-card">
                        <div class="card-body p-3">
                            <div class="d-inline-flex align-items-center justify-content-center bg-danger bg-opacity-10 text-danger rounded-circle mb-2"
                                style="width: 40px; height: 40px;">
                                <i class="fas fa-bell"></i>
                            </div>
                            <h3 class="fw-bold mb-0 text-dark">{{ unread_notifs }}</h3>
                            <span class="small text-muted">Notifications</span>
                        </div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="card border-0 shadow-sm rounded-4 text-center h-100 hover-card">
                        <div class="card-body p-3">
                            <div class="d-inline-flex align-items-center justify-content-center bg-success bg-opacity-10 text-success rounded-circle mb-2"
                                style="width: 40px; height: 40px;">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <h3 class="fw-bold mb-0 text-dark">{{ pending_requests }}</h3>
                            <span class="small text-muted">Requests</span>
                        </div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="card border-0 shadow-sm rounded-4 text-center h-100 hover-card">
                        <div class="card-body p-3">
                            <div class="d-inline-flex align-items-center justify-content-center bg-info bg-opacity-10 text-info rounded-circle mb-2"
                                style="width: 40px; height: 40px;">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <h3 class="fw-bold mb-0 text-dark">{{ unread_messages }}</h3>
                            <span class="small text-muted">Messages</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Create Post Widget -->
            <div class="card border-0 shadow-sm rounded-4 mb-4">
                <div class="card-body p-3">
                    <div class="d-flex align-items-center gap-3">
                        {% if user and user.profile_pic %}
                        <img src="{{ url_for('static', filename='uploads/profiles/' ~ user.profile_pic) }}"
                            class="rounded-circle" style="width: 48px; height: 48px; object-fit: cover;">
                        {% else %}
                        <div class="rounded-circle bg-light d-flex align-items-center justify-content-center text-muted border border-light"
                            style="width: 48px; height: 48px;"><i class="fas fa-user"></i></div>
                        {% endif %}
                        <a href="{{ url_for('posts.create') }}"
                            class="btn btn-light rounded-pill flex-grow-1 text-start text-muted border ps-3 bg-white">
                            Start a post...
                        </a>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-3 pt-2">
                        <button class="btn btn-sm btn-text text-muted"><i
                                class="fas fa-image text-primary me-2"></i>Media</button>
                        <button class="btn btn-sm btn-text text-muted"><i
                                class="fas fa-calendar-alt text-warning me-2"></i>Event</button>
                        <button class="btn btn-sm btn-text text-muted"><i
                                class="fas fa-newspaper text-danger me-2"></i>Article</button>
                    </div>
                </div>
            </div>

            <!-- Dashboard Content Section title -->
            <div class="d-flex align-items-center justify-content-between mb-3">
                <h6 class="text-muted fw-bold small m-0">
                    <div class="d-inline-block w-25px border-top border-2 border-primary me-2 align-middle"></div>YOUR
                    ACTIVITY
                </h6>
            </div>

            <!-- Applications -->
            {% if my_applications %}
            <div class="card border-0 shadow-sm rounded-4 mb-4">
                <div class="card-header bg-white border-bottom-0 pt-3 pb-0">
                    <h6 class="fw-bold mb-0"><i class="fas fa-briefcase text-primary me-2"></i>Active Applications</h6>
                </div>
                <div class="card-body">
                    {% for app in my_applications %}
                    <div
                        class="d-flex align-items-center justify-content-between py-2 border-bottom {{ 'border-bottom-0' if loop.last else '' }}">
                        <div class="d-flex align-items-center gap-3">
                            <div class="rounded bg-light d-flex align-items-center justify-content-center"
                                style="width: 40px; height: 40px;">
                                <i class="fas fa-building text-muted"></i>
                            </div>
                            <div>
                                <a href="{{ url_for('opportunities.view_opportunity', id=app.opportunity_id) }}"
                                    class="fw-bold text-dark text-decoration-none d-block">{{ app.title }}</a>
                                <small class="text-muted">{{ app.company }}</small>
                            </div>
                        </div>
                        <span
                            class="badge {{ 'bg-warning text-dark' if app.status == 'pending' else 'bg-success' }} rounded-pill">{{
                            app.status|default('Pending')|title }}</span>
                    </div>
                    {% endfor %}
                </div>
                <div class="card-footer bg-white border-top-0 text-center pb-3">
                    <a href="{{ url_for('opportunities.my_applications') }}"
                        class="text-primary fw-medium small text-decoration-none">View all applications <i
                            class="fas fa-arrow-right ms-1"></i></a>
                </div>
            </div>
            {% endif %}

            <!-- Recent Notifications Preview -->
            <div class="card border-0 shadow-sm rounded-4 mb-4">
                <div
                    class="card-header bg-white border-bottom-0 pt-3 pb-0 d-flex justify-content-between align-items-center">
                    <h6 class="fw-bold mb-0"><i class="fas fa-bell text-warning me-2"></i>Recent Updates</h6>
                    <a href="#" class="text-muted small"><i class="fas fa-ellipsis-h"></i></a>
                </div>
                <div class="card-body p-0">
                    {% if recent_notifications %}
                    <div class="list-group list-group-flush rounded-bottom-4">
                        {% for notif in recent_notifications[:3] %}
                        <a href="{{ url_for('notifications.list_notifications') }}"
                            class="list-group-item list-group-item-action border-0 px-3 py-3">
                            <div class="d-flex align-items-start gap-3">
                                <div class="rounded-circle bg-light d-flex align-items-center justify-content-center flex-shrink-0"
                                    style="width: 36px; height: 36px;">
                                    <i class="fas fa-info text-primary small"></i>
                                </div>
                                <div>
                                    <p class="mb-1 small text-dark">{{ notif.message }}</p>
                                    <small class="text-muted" style="font-size: 0.75rem;">{{
                                        notif.created_at.strftime('%b %d') }}</small>
                                </div>
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="p-4 text-center text-muted">
                        <i class="fas fa-bell-slash mb-2 fs-5 d-block"></i>
                        <span class="small">No new notifications</span>
                    </div>
                    {% endif %}
                </div>
            </div>

        </div>

        <!-- RIGHT COLUMN: Widgets -->
        <div class="col-lg-3 d-none d-lg-block">
            <!-- News Widget -->
            <div class="card border-0 shadow-sm rounded-4 mb-4">
                <div
                    class="card-header bg-white border-bottom-0 pt-3 pb-0 d-flex justify-content-between align-items-center">
                    <h6 class="fw-bold mb-0 text-dark">SkillentHub News</h6>
                    <i class="fas fa-info-circle text-muted small"></i>
                </div>
                <div class="card-body pt-2">
                    <ul class="list-unstyled mb-0">
                        <li class="mb-3">
                            <a href="#" class="text-dark text-decoration-none fw-medium d-block mb-1 text-truncate">Top
                                Design Trends 2026</a>
                            <small class="text-muted d-block">1d ago • 2,403 readers</small>
                        </li>
                        <li class="mb-3">
                            <a href="#" class="text-dark text-decoration-none fw-medium d-block mb-1 text-truncate">Tech
                                Hiring Slows Down?</a>
                            <small class="text-muted d-block">4h ago • 8,129 readers</small>
                        </li>
                        <li class="mb-3">
                            <a href="#"
                                class="text-dark text-decoration-none fw-medium d-block mb-1 text-truncate">Python 3.14
                                Released</a>
                            <small class="text-muted d-block">12h ago • 5,600 readers</small>
                        </li>
                    </ul>
                    <a href="#" class="btn btn-light btn-sm w-100 rounded-pill mt-2">Show more <i
                            class="fas fa-angle-down"></i></a>
                </div>
            </div>

            <!-- Advertisement / Promo -->
            <div class="card border-0 shadow-sm rounded-4 mb-4 overflow-hidden position-relative">
                <div class="card-body text-center pt-4 pb-4">
                    <small class="text-muted position-absolute top-0 end-0 m-2" style="font-size: 0.65rem;">Ad</small>
                    <div class="mb-3 text-primary">
                        <i class="fas fa-rocket fa-3x"></i>
                    </div>
                    <h6 class="fw-bold">Boost Your Career</h6>
                    <p class="small text-muted mb-3">Get access to exclusive job listings and mentorship.</p>
                    <button class="btn btn-outline-primary rounded-pill btn-sm px-4">Learn More</button>
                </div>
            </div>

            <!-- Footer Links Mini -->
            <div class="text-center">
                <div class="d-flex flex-wrap justify-content-center gap-2 mb-2">
                    <a href="#" class="text-muted small text-decoration-none">About</a>
                    <a href="#" class="text-muted small text-decoration-none">Accessibility</a>
                    <a href="#" class="text-muted small text-decoration-none">Help Center</a>
                </div>
                <p class="text-muted small" style="font-size: 0.75rem;">SkillentHub Corporation &copy; 2026</p>
            </div>
        </div>
    </div>
</div>

<!-- Mobile Float Button for New Post -->
<div class="d-lg-none position-fixed bottom-0 end-0 m-4 pe-2 pb-2" style="z-index: 100;">
    <a href="{{ url_for('posts.create') }}"
        class="btn btn-primary rounded-circle shadow-lg d-flex align-items-center justify-content-center"
        style="width: 56px; height: 56px;">
        <i class="fas fa-plus fs-4"></i>
    </a>
</div>
{% endblock %}